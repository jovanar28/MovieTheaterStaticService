(function(){"use strict";var e={3624:function(e,t,a){var s=a(6369),r=function(){var e=this,t=e._self._c;return t("body",[t("div",{attrs:{id:"app"}},[t("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"dark"}},[t("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),t("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[t("b-navbar-nav",{staticClass:"ml-auto"},[t("b-navbar-nav",[e.token?e._e():t("b-nav-item",{attrs:{to:"/register"}},[e._v("Register")]),e.token?t("b-nav-item",{on:{click:function(t){return e.logout()}}},[e._v("Log Out")]):t("b-nav-item",{attrs:{to:"/login"}},[e._v("Login")]),e.token?t("b-nav-item",{attrs:{to:"/cart"}},[e._v("Cart")]):e._e()],1)],1)],1)],1),t("router-view")],1)])},o=[],n=a(3822),i={name:"App",computed:{...(0,n.rn)(["token","reservedSeats"])},mounted(){localStorage.token&&this.setToken(localStorage.token)},methods:{...(0,n.OI)(["setToken","removeToken"]),logout(){this.removeToken()}}},l=i,d=a(1001),c=(0,d.Z)(l,r,o,!1,null,null,null),u=c.exports,h=a(2631),m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[e._m(0),t("section",[e.movieTheathers?t("TheathersHolder",{staticClass:"thHolder",attrs:{theatherObjects:e.movieTheathers}}):e._e()],1)])},p=[function(){var e=this,t=e._self._c;return t("header",[t("h1",[e._v("Movie theaters")])])}],f=(a(7658),function(){var e=this,t=e._self._c;return t("div",{staticClass:"hello"},[t("div",{staticClass:"row",attrs:{id:"theaters_grid"}},e._l(e.theatherObjects,(function(a){return e.theatherObjects?t("SingleTheather",{key:a.id,staticClass:"col-6 col-md-4",attrs:{theather:a}}):e._e()})),1)])}),v=[],_=function(){var e=this,t=e._self._c;return t("b-card",{staticClass:"theather",attrs:{title:e.theather.name,"img-src":"https://pyxis.nymag.com/v1/imgs/978/4d0/4b4779e1dcb86984abe55c08366f9babe7-13-empty-theater.rsquare.w700.jpg","img-top":""},scopedSlots:e._u([{key:"footer",fn:function(){return[t("b-button",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:e.listSale}},[e._v("Sale")])]},proxy:!0}])},[t("b-card-text",[e._v(" "+e._s("Lokacija: "+e.theather.lokacija)+" ")])],1)},b=[],g={name:"SingleTheather",props:{theather:Object},methods:{listSale(e){e.preventDefault(),this.$router.push({name:"sale",params:{id:this.theather.id}})}}},S=g,y=(0,d.Z)(S,_,b,!1,null,"79a01cca",null),k=y.exports,w={name:"TheatersHolder",props:{theatherObjects:Array},components:{SingleTheather:k},data(){return{movieTheathers:null}},mounted(){console.log("AAA",this.theatherObjects)}},j=w,T=(0,d.Z)(j,f,v,!1,null,null,null),x=T.exports,C={name:"Home",components:{TheathersHolder:x},data(){return{movieTheathers:null}},mounted(){this.movieTheathers=[],fetch("http://localhost:8000/admin/movietheater",{method:"GET"}).then((e=>e.json())).then((e=>{for(let t=0;t<e.length;t++)fetch(`http://localhost:8000/admin/location/${e[t].location_id}`,{method:"GET"}).then((e=>e.json())).then((a=>{e[t]["lokacija"]=a.street_name+","+a.city_name,this.movieTheathers.push(e[t])}));console.log(this.movieTheathers)}))}},P=C,$=(0,d.Z)(P,m,p,!1,null,"94a0a96a",null),O=$.exports,A=function(){var e=this,t=e._self._c;return t("div",{staticClass:"about"},e._l(e.saleArr,(function(a){return e.saleArr?t("Sala",{key:a.id,attrs:{sala:a}}):e._e()})),1)},R=[],Z=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sala"},[t("header",[t("h2",[e._v(e._s("Sala broj "+this.sala.id))])]),e.items?t("b-table",{attrs:{id:"rasporedTable",hover:"",fixed:"",small:"",fields:e.fields,items:e.items,striped:""},on:{"row-clicked":e.rowClicked}}):e._e()],1)},D=[],E={name:"Sala",props:{sala:Object},data(){return{fields:["start_time","end_time","date","tittle"],items:null}},mounted(){this.items=[],console.log("Sala render",this.sala),fetch(`http://localhost:8000/admin/schedule/findScheduleByAuditorium/${this.sala.id}`,{method:"GET"}).then((e=>e.json())).then((e=>{console.log("ca ",e);for(let t=0;t<e.length;t++)fetch(`http://localhost:8000/admin/movie/${e[t].movie_sch_id}`,{method:"GET"}).then((e=>e.json())).then((a=>{console.log("Movie from schedule ",a);e[t]["movieID"]=a.id,e[t]["tittle"]=a.tittle,console.log(e),this.items.push(e[t])}))}))},methods:{rowClicked(e,t){this.$router.push({name:"reserve",params:{auditoriumid:e.auditorium_sch_id,scheduleid:e.id}})}}},z=E,I=(0,d.Z)(z,Z,D,!1,null,"2187f1d0",null),L=I.exports,G={name:"SaleView",components:{Sala:L},computed:{...(0,n.rn)(["saleArr"])},methods:{...(0,n.nv)(["fetchAuditoriumByCinema"])},mounted(){this.fetchAuditoriumByCinema(this.$route.params.id)}},q=G,B=(0,d.Z)(q,A,R,!1,null,"c4cc58a2",null),F=B.exports,H=function(){var e=this,t=e._self._c;return t("div",{staticClass:"reserve"},[t("h1",[e._v("Pick your seats:")]),t("SeatHolder"),e._l(e.reservedSeats,(function(a){return e.reservedSeats?t("b-card",{key:a.seat_res_id},[t("b-card-text",[t("h3",[e._v(e._s("Rezervisano sediste "+a.seat_res_id))]),t("b-button",{attrs:{variant:"danger"},on:{click:function(t){return e.removeReservedSeat(a.seat_res_id)}}},[e._v("Izbaci sediste")])],1)],1):e._e()})),t("br"),t("div",{staticClass:"text-center"},[t("b-button",{attrs:{variant:"dark",size:"lg"},on:{click:e.rezervisiSedista}},[e._v("Reserve")])],1)],2)},M=[],V=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sedista"},[t("div",{staticClass:"row",attrs:{id:"sedista_grid"}},e._l(e.seats,(function(a){return e.seats?t("SingleSeat",{key:a.id,staticClass:"col-6 col-md-4",attrs:{seat:a}}):e._e()})),1)])},J=[],N=function(){var e=this,t=e._self._c;return t("div",{staticClass:"seat"},[t("b-button",{attrs:{variant:"primary"},on:{click:e.rezervisi}},[t("img",{attrs:{src:"https://cdn-icons-png.flaticon.com/512/24/24868.png"}}),e._v(e._s("Sediste "+this.seat.id)+" ")])],1)},U=[],K=a(6052),W=a.n(K),X={name:"SingleSeat",props:{seat:Object},computed:{...(0,n.rn)(["token"])},data(){return{btnClass:"red-color",selected:0}},methods:{...(0,n.nv)(["addPrice","addSeatToList","removeSeatFromList"]),async rezervisi(e){if(e.preventDefault(),!this.token)return void alert("Please login or create an account");this.addPrice(10);let t=W().decode(this.token).userId;console.log("Korisnicki id ",t);let a=0;await fetch(`http://localhost:8000/admin/schedule/${this.seat.schedule_id}`,{method:"GET"}).then((e=>e.json())).then((e=>{console.log(e),a=e.movie_sch_id}));let s={user_res_id:t,seat_res_id:this.seat.id,auditorium_res_id:this.seat.auditorium_seat_id,movie_res_id:a,schedule_id:this.seat.schedule_id};console.log("Objekat za slanje na fetch ",s),this.addSeatToList(s)}}},Y=X,Q=(0,d.Z)(Y,N,U,!1,null,null,null),ee=Q.exports,te={name:"SeatHolder",components:{SingleSeat:ee},computed:{...(0,n.rn)(["seats"])},mounted(){console.log("usao",this.seatObjects)}},ae=te,se=(0,d.Z)(ae,V,J,!1,null,null,null),re=se.exports,oe={name:"ReserveView",components:{SeatHolder:re},computed:{...(0,n.rn)(["ticketPrice","reservedSeats","token"])},methods:{...(0,n.nv)(["removeSeatFromList","fetchAvailableSeats"]),async rezervisiSedista(e){if(e.preventDefault(),!this.token)return void alert("Cannot create any reservations when signed out");for(let t=0;t<this.reservedSeats.length;t++)await fetch("http://localhost:8000/admin/reservation/addReservation/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.reservedSeats[t])}).then((e=>e.json())).then((e=>{console.log("Rezervacija je kreirana ",e)}));console.log("Rezervacije su kreirane");this.$router.auditoriumid;this.$router.push({name:"home"})},removeReservedSeat(e){this.removeSeatFromList(e)}},mounted(){let e={audid:this.$route.params.auditoriumid,schid:this.$route.params.scheduleid};console.log("Route parameters ",e),this.fetchAvailableSeats(e)}},ne=oe,ie=(0,d.Z)(ne,H,M,!1,null,null,null),le=ie.exports,de=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"register"}},[t("h3",[e._v("Create Account")]),t("b-form",{on:{submit:e.onSubmit}},[t("b-form-group",{attrs:{label:"First name:","label-for":"name"}},[t("b-form-input",{attrs:{id:"name",type:"text",placeholder:"Enter first name",required:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("b-form-group",{attrs:{label:"Last name:","label-for":"surname"}},[t("b-form-input",{attrs:{id:"surname",type:"text",placeholder:"Enter last name",required:""},model:{value:e.form.surname,callback:function(t){e.$set(e.form,"surname",t)},expression:"form.surname"}})],1),t("b-form-group",{attrs:{label:"Username:","label-for":"username"}},[t("b-form-input",{attrs:{id:"username",type:"text",placeholder:"Enter username",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("b-form-group",{attrs:{label:"Password:","label-for":"password"}},[t("b-form-input",{attrs:{id:"password",type:"password",placeholder:"Enter password",required:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("b-form-group",{attrs:{label:"Credit card number:","label-for":"card"}},[t("b-form-input",{attrs:{id:"card",type:"text",placeholder:"Enter credit card number",required:""},model:{value:e.form.card,callback:function(t){e.$set(e.form,"card",t)},expression:"form.card"}})],1),t("br"),t("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Submit")])],1)],1)},ce=[],ue={name:"RegisterView",data(){return{form:{name:"",lastname:"",username:"",password:"",credit:""}}},methods:{...(0,n.nv)(["register"]),onSubmit(e){e.preventDefault();let t={first_name:this.form.name,last_name:this.form.surname,username:this.form.username,password:this.form.password,credit_card_num:this.form.card,role_id:3};this.register(t),this.$router.push({name:"home"})}}},he=ue,me=(0,d.Z)(he,de,ce,!1,null,null,null),pe=me.exports,fe=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"login"}},[t("h3",[e._v("Please enter your credentials")]),t("b-form",{on:{submit:e.onSubmit}},[t("b-form-group",{attrs:{label:"Username:","label-for":"username"}},[t("b-form-input",{attrs:{id:"username",type:"text",placeholder:"Enter username",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("b-form-group",{attrs:{label:"Password:","label-for":"password"}},[t("b-form-input",{attrs:{id:"password",type:"password",placeholder:"Enter password",required:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("br"),t("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Submit")])],1)],1)},ve=[],_e={name:"LoginView",data(){return{form:{username:"",password:""}}},methods:{...(0,n.nv)(["login"]),onSubmit(e){e.preventDefault(),this.login(this.form),this.$router.push({name:"home"})}}},be=_e,ge=(0,d.Z)(be,fe,ve,!1,null,"6a8aa4a2",null),Se=ge.exports,ye=function(){var e=this,t=e._self._c;return t("div",[e._l(e.cleanData,(function(a){return e.cleanData?t("b-card",{key:a.index,scopedSlots:e._u([{key:"footer",fn:function(){return[t("p",[t("b",[e._v("$15.00")])])]},proxy:!0}],null,!0)},[t("b-card-text",[t("h3",[e._v(e._s(a.movie_data))]),e._v(" "+e._s(a.date_time)+" "),t("h4",[e._v(e._s(a.cinema_data))]),t("h5",[e._v("Sediste "+e._s(a.seat_id))])])],1):e._e()})),e.payment_done?t("b-alert",{attrs:{show:"",variant:"success"}},[t("h4",{staticClass:"alert-heading"},[e._v("Whippie! You have successfully purchased your tickets!")]),t("hr"),t("p",{staticClass:"mb-0"},[t("b-button",{on:{click:e.closeMessage}},[e._v("Okay!")])],1)]):e._e(),t("span",[t("b",[e._v("Total amount $"+e._s(this.totalAmnt))])]),t("br"),t("b-button",{attrs:{variant:"warning"},on:{click:e.platiSve}},[e._v("Pay all")])],2)},ke=[],we={name:"CartView",data(){return{cleanData:null,totalAmnt:0,payment_done:!1}},computed:{...(0,n.rn)(["reservedSeats"])},methods:{...(0,n.nv)(["resetReserved"]),async salaInfo(e){return new Promise(((t,a)=>{fetch(`http://localhost:8000/admin/auditorium/${e}`).then((e=>e.json())).then((e=>{t(e)}))}))},async scheduleInfo(e){return new Promise(((t,a)=>{fetch(`http://localhost:8000/admin/schedule/${e}`).then((e=>e.json())).then((e=>{t(e)}))}))},async movieInfo(e){return new Promise(((t,a)=>{fetch(`http://localhost:8000/admin/movie/${e}`).then((e=>e.json())).then((e=>{t(e)}))}))},async cinemaInfo(e){return new Promise(((t,a)=>{fetch(`http://localhost:8000/admin/movietheater/${e}`).then((e=>e.json())).then((e=>{t(e)}))}))},async izvlacenjePodataka(){this.cleanData=[];for(let e=0;e<this.reservedSeats.length;e++){let t=await this.salaInfo(this.reservedSeats[e].auditorium_res_id),a=await this.scheduleInfo(this.reservedSeats[e].schedule_id),s=await this.movieInfo(this.reservedSeats[e].movie_res_id),r=await this.cinemaInfo(t.movietheater_id);console.log("Raspored ",a),console.log("Film",s),console.log("Bioskop",r),console.log("Sala",t);let o={movie_data:s.tittle+" Zanr: "+s.genre,date_time:"Datum: "+a.date+" Vreme: "+a.start_time+" - "+a.end_time,cinema_data:r.name,index:e,seat_id:this.reservedSeats[e].seat_res_id};this.cleanData.push(o)}},makePayment(e){let t=this.reservedSeats[e];fetch(`http://localhost:8000/admin/reservation/findRes/${t.auditorium_res_id}/${t.schedule_id}/${t.seat_res_id}/${t.movie_res_id}/${t.user_res_id}`).then((e=>e.json())).then((e=>{console.log(e);let a=e[0].id,s={user_pay_id:t.user_res_id,seat_pay_id:t.seat_res_id,auditorium_pay_id:t.auditorium_res_id,movie_pay_id:t.movie_res_id,sch_pay_id:t.schedule_id,res_pay_id:a,amount:15},r=JSON.stringify(s);console.log("Za placanje ",s),fetch("http://localhost:8000/admin/payment/addPayment",{method:"POST",headers:{"Content-Type":"application/json"},body:r}).then((e=>e.json())).then((e=>{e.msg&&alert(e.msg),e.err&&alert(e.err),console.log("Payment created ",e)}))})),console.log("Za placanje -> ",this.reservedSeats[e])},platiSve(e){e.preventDefault();for(let t=0;t<this.reservedSeats.length;t++)this.makePayment(t);this.payment_done=!0},closeMessage(){this.payment_done=!1,this.cleanData=null,this.resetReserved(),this.$router.push({name:"home"})}},mounted(){this.izvlacenjePodataka()},watch:{cleanData(){this.totalAmnt=0,console.log(this.cleanData.length);for(let e=0;e<this.cleanData.length;e++)this.totalAmnt+=15}}},je=we,Te=(0,d.Z)(je,ye,ke,!1,null,"be5146de",null),xe=Te.exports;s["default"].use(h.ZP);const Ce=[{path:"/",name:"home",component:O},{path:"/sale/:id",name:"sale",component:F},{path:"/reserve/:auditoriumid/:scheduleid",name:"reserve",component:le},{path:"/register",name:"register",component:pe},{path:"/login",name:"login",component:Se},{path:"/cart",name:"cart",component:xe}],Pe=new h.ZP({mode:"history",base:"/",routes:Ce});var $e=Pe;s["default"].use(n.ZP);var Oe=new n.ZP.Store({state:{ticketPrice:0,token:"",reservedSeats:[],saleArr:[],seats:[]},mutations:{addTicket(e,t){e.ticketPrice+=t},setToken(e,t){e.token=t,localStorage.token=t},removeToken(e){e.token="",localStorage.token=""},addSeat(e,t){e.reservedSeats.push(t)},removeSeat(e,t){e.reservedSeats.splice(e.reservedSeats.indexOf(t),1)},clearReservedSeats(e,t){e.reservedSeats=[]},addToSale(e,t){e.saleArr.push(t)},resetSaleArr(e){e.saleArr=[]},setSeat(e,t){e.seats=t},resetSeat(e){e.seats=[]}},actions:{setSeatAction({commit:e},t){e("setSeat",t)},clearSeatArr({commit:e}){e("resetSeat")},addPrice({commit:e},t){e("addTicket",t)},register({commit:e},t){fetch("http://127.0.0.1:9000/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((t=>{t.msg?alert(t.msg):e("setToken",t.token)}))},login({commit:e},t){fetch("http://127.0.0.1:9000/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((t=>{t.msg?alert(t.msg):e("setToken",t.token)}))},addSeatToList({commit:e},t){e("addSeat",t)},removeSeatFromList({commit:e},t){e("removeSeat",t)},resetReserved({commit:e}){e("clearReservedSeats")},fetchAuditoriumByCinema({commit:e},t){e("resetSaleArr"),fetch(`http://localhost:8000/admin/auditorium/findByCinema/${t}`,{method:"GET"}).then((e=>e.json())).then((t=>{for(let a=0;a<t.length;a++)e("addToSale",t[a])}))},fetchAvailableSeats({commit:e},t){let a=t.audid,s=t.schid;console.log("Function called with ",a,s),e("resetSeat");let r=[],o=[],n=[],i=[];fetch(`http://localhost:8000/admin/seat/findSeatByAuditorium/${a}`,{method:"GET"}).then((e=>e.json())).then((t=>{for(let e=0;e<t.length;e++)console.log("Prvi fetch ",t[e]),r.push(t[e]),i.push(t[e]);console.log(r),fetch(`http://localhost:8000/admin/reservation/findBySchAud/${a}/${s}`,{method:"GET"}).then((e=>e.json())).then((t=>{if(0==t.length){for(let e=0;e<r.length;e++)r[e]["schedule_id"]=s,console.log("Current seat -> ",r[e]);e("setSeat",r)}else{for(let e=0;e<t.length;e++)console.log("Drugi fetch ",t[e]),o.push(t[e]);console.log("Sedista za auditorijum ",r),console.log("Rezervisana sedista ",o);let a=[];for(let e=0;e<r.length;e++)for(let t=0;t<o.length;t++)console.log("Poredim ",o[t].seat_res_id," i ",r[e].id),o[t].seat_res_id===r[e].id&&(console.log("usao sam ovde"),console.log("Poredim ",r[e].id," i ",o[t].seat_res_id," i=",e),a.push(e)),r[e]["schedule_id"]=s,console.log("Current seat -> ",r[e]);console.log("Ispis -> ",r),console.log("Ispis -> ",a);for(let e=0;e<a.length;e++)0==a[e]?r.splice(a[e],1):r.splice(a[e]-1,1);console.log("seats for aud ",r),console.log("Available seats: ",n),e("setSeat",r)}}))}))}}}),Ae=a(6681),Re=a(9425);a(7024);s["default"].use(Ae.XG7),s["default"].use(Re.A7),s["default"].config.productionTip=!1,new s["default"]({router:$e,store:Oe,render:e=>e(u)}).$mount("#app")}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,r,o){if(!s){var n=1/0;for(c=0;c<e.length;c++){s=e[c][0],r=e[c][1],o=e[c][2];for(var i=!0,l=0;l<s.length;l++)(!1&o||n>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(i=!1,o<n&&(n=o));if(i){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[s,r,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,o,n=s[0],i=s[1],l=s[2],d=0;if(n.some((function(t){return 0!==e[t]}))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(l)var c=l(a)}for(t&&t(s);d<n.length;d++)o=n[d],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(c)},s=self["webpackChunkvue_script"]=self["webpackChunkvue_script"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(3624)}));s=a.O(s)})();
//# sourceMappingURL=app.070f115c.js.map